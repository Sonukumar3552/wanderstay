<% layout("/layouts/boilerplate") %>

<div class="container mt-4 mb-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <h3 class="mb-4 text-center">Edit Listing</h3>

      <form 
        action="/listings/<%= listing._id %>?_method=PUT" 
        method="POST" 
        enctype="multipart/form-data"   <!-- IMPORTANT -->
      >
        <!-- Title -->
        <div class="mb-3">
          <label class="form-label">Title</label>
          <input 
            type="text" 
            name="listing[title]" 
            class="form-control" 
            value="<%= listing.title %>" 
            required
          />
        </div>

        <!-- Price -->
        <div class="mb-3">
          <label class="form-label">Price</label>
          <input 
            type="number" 
            name="listing[price]" 
            class="form-control" 
            value="<%= listing.price %>" 
            required
          />
        </div>

        <!-- Location -->
        <div class="mb-3">
          <label class="form-label">Location</label>
          <input 
            type="text" 
            name="listing[location]" 
            class="form-control" 
            value="<%= listing.location %>" 
            required
          />
        </div>

        <!-- Category -->
        <div class="mb-3">
          <label class="form-label">Category</label>
          <select name="listing[category]" class="form-select">
            <option value="rooms" <%= listing.category === "rooms" ? "selected" : "" %>>Rooms</option>
            <option value="iconic" <%= listing.category === "iconic" ? "selected" : "" %>>Iconic Cities</option>
            <option value="mountain" <%= listing.category === "mountain" ? "selected" : "" %>>Mountains</option>
            <!-- jo bhi categories tum use kar rahe ho -->
          </select>
        </div>

        <!-- Description -->
        <div class="mb-3">
          <label class="form-label">Description</label>
          <textarea 
            name="listing[description]" 
            class="form-control" 
            rows="4"
          ><%= listing.description %></textarea>
        </div>

        <!--  Current Image Preview -->
        <div class="mb-3">
          <label class="form-label d-block">Current Image</label>
          <img 
            src="<%= listing.image && listing.image.url ? listing.image.url : 'https://tse1.mm.bing.net/th/id/OIP.FtudhIBH-HYhxMpS4TU-sAHaE8?rs=1&pid=ImgDetMain' %>" 
            alt="Current Image"
            class="img-fluid rounded mb-2"
            style="max-height: 250px; object-fit: cover;"
          />
        </div>

        <!-- New Image Upload Option -->
        <div class="mb-3">
          <label class="form-label">Change Image (optional)</label>
          <input 
            type="file" 
            name="image" 
            class="form-control"
            accept="image/*"
          />
          <small class="form-text text-muted">
            “If you choose a new image, the old one will be replaced. If you don’t select anything, the existing image will remain.”
          </small>
        </div>

        <button type="submit" class="btn btn-primary w-100">
          Save Changes
        </button>
      </form>
    </div>
  </div>
</div>
